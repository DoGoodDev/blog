<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Configuring A Kotlin Docker Application In Gradle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
	
<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">You Do Good blog</a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="../../about.html">About</a></li>
        <li><a href="../../tags/index.html">Tags</a></li>
      </ul>
    </div>
  </div>
</div>
<div class="container">
	<div class="page-header">
		<h1>Configuring A Kotlin Docker Application In Gradle</h1>
	</div>

	<p><em>First Published: 01 April 2022</em></p>
	<p><em>Last Modified: 01 April 2022</em></p>

	<p><div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post assumes you have <a href="https://youdogood.github.io/blog/2022/03/configuring-a-kotlin-jvm-project-with-gradle.html">set up a Kotlin JVM project with Gradle</a> already.</p>
</div>
<div class="paragraph">
<p>Knowledge about docker, or having docker installed is not necessary, but if you want to run the image you create at the end then you will need it. Installation of docker is out of scope for this blog.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goal_of_this_post">Goal Of This Post</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of this blog post is configure a simple Kotlin command line application using Gradle, and then packaging that application as a docker image.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="apply_the_jib_gradle_plugin">Apply The Jib Gradle Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apply the <a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin">jib gradle plugin</a> by adding the following code to your plugins block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">plugins {
    id("com.google.cloud.tools.jib") version "3.2.1"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The GitHub page for jib alone contains brilliant documentation on what it is for an how to use it, so it is recommended to go read that for further information, but to summarise:</p>
</div>
<div class="paragraph">
<p>Jib is a tool made by Google to create Docker and OCI images <em>without</em> having docker installed. It is specifically for packaging Java applications and intelligently layers different parts of a Java application (the dependency jars, project dependencies, application classes etc). This often results in the images being built faster as the layers can be reused if they haven&#8217;t changed (a good example would be there&#8217;s no rebuild of the dependencies layer if you have just changed some source code).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add_a_main_class">Add a Main class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assuming that you have the code from the prerequisite blog post, add a new file under <code>dev.youdogood.blog</code> called <code>main.kt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package dev.youdogood.blog

fun main() {
    listOf("1", "2", "egg").forEach { item -&gt;
        val itemAsNumber = item.toIntOrNull()
        if (itemAsNumber == null) {
            println("$item is not a number!")
            return
        }

        val output = if (isEven(itemAsNumber)) "$itemAsNumber is even!" else "$itemAsNumber is odd!"
        println(output)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason we want a main class is when a docker image is run, it needs to know which class to start with in our code. You can specify the main class in the <code>jib</code> configuration in your <code>build.gradle.kts</code> file, but in our case it&#8217;s unambiguous (we have only one main function) so jib will pick this up automatically.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build_the_docker_image">Build The Docker Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three tasks provided by <code>jib</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jib</code> - builds a docker image and pushes it to a registry (out of scope for this blog)</p>
</li>
<li>
<p><code>jibBuildTar</code> - builds the docker image as a <code>.tar</code> file, and stores it to disk</p>
</li>
<li>
<p><code>jibDockerBuild</code> - builds the docker image (without the daemon), and then pushes it to your local docker daemon</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you haven&#8217;t configured docker you can run the <code>jibBuildTar</code> task to see your docker image get built, but for the next section we&#8217;ll be using <code>jibDockerBuild</code> which requires docker to be running locally (setting up docker locally is out of scope for this blog post, and it&#8217;s recommended you follow another guide online).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run_the_docker_image">Run The Docker Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assuming you&#8217;ve run <code>jibDockerBuild</code> in the previous step you should now have a docker image you can run. The name of your image will be of the format <code>projectName:version</code>. For example my project is called <code>blog-code</code> and the version was <code>1.0-SNAPSHOT</code>, the gradle task printed out the following at the end:</p>
</div>
<div class="paragraph">
<p><code>Built image to Docker daemon as blog-code:1.0-SNAPSHOT</code></p>
</div>
<div class="paragraph">
<p>So now I can run in my terminal the following:</p>
</div>
<div class="paragraph">
<p><code>docker run blog-code:1.0-SNAPSHOT</code></p>
</div>
<div class="paragraph">
<p>With the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 is odd!
2 is even!
egg is not a number!</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further_use_cases">Further Use Cases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In later blogs I&#8217;m hoping to explore some less obvious use cases of <code>jib</code>, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Locally running <code>kafka-connect</code> plugins bundled together using Gradle&#8217;s dependency resolution functionality (hint: kafka-connect just needs to know what directory the plugins are going to be in, and <code>jib</code> copy resolved dependencies to a certain directory in to docker image!)</p>
</li>
<li>
<p>Creating custom <code>Keycloak</code> images that you can add your own themes or custom SPIs to (service provider interfaces, these can let you do awesome things like integrate Keycloak events with Kafka).</p>
</li>
</ul>
</div>
</div>
</div></p>

	<hr />
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2014 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../js/jquery-1.11.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/prettify.js"></script>
    
  </body>
</html>